var yrs = rows.map(function(r){ var n=parseInt(r[1],10); return isNaN(n)?null:n; })
.filter(function(x){ return x!==null; });
var span = (yrs.length>0) ? (Math.min.apply(null, yrs) + '–' + Math.max.apply(null, yrs)) : '—';
var authors = rows.map(function(r){ return r[4]; });
var focuses = rows.map(function(r){ return r[3]; });
var el;
el = document.getElementById('stat-total');   if (el) el.textContent = total.toString();
el = document.getElementById('stat-span');    if (el) el.textContent = span;
el = document.getElementById('stat-authors'); if (el) el.textContent = uniqueNonEmpty(authors).toString();
el = document.getElementById('stat-focus');   if (el) el.textContent = uniqueNonEmpty(focuses).toString();
}
// Update when the table redraws
table.on('draw.dt search.dt order.dt', updateStats);
// Update when Crosstalk filters change
if (window.crosstalk) {
var fh = new crosstalk.FilterHandle('pubs');
fh.on('change', function(){ setTimeout(updateStats, 0); });
crosstalk.var('selection').on('change', function(){ setTimeout(updateStats, 0); });
}
// Initial compute
setTimeout(updateStats, 0);
")
)
)
)
# ----- Setup -----
library(readr); library(dplyr); library(tidyr); library(stringr); library(janitor)
library(plotly); library(DT); library(crosstalk); library(bslib); library(htmltools)
invisible(crosstalk::crosstalkLibs())
# Pink-forward theme
theme <- bslib::bs_theme(
version = 5, bootswatch = "cosmo",
primary   = "#E91E63", body_color = "#2f3342",
base_font = bslib::font_google("Inter")
)
bslib::bs_theme_set(theme)
# ----- Data helpers -----
read_publications <- function(path) {
df <- readr::read_csv(path, show_col_types = FALSE) |>
janitor::clean_names()
if ("year" %in% names(df)) suppressWarnings(df$year <- as.integer(df$year))
for (nm in intersect(c("title","author","publicationtype","focusarea"), names(df))) {
df[[nm]] <- as.character(df[[nm]]) |> stringr::str_squish()
}
# map link column if named differently in CSV
link_candidates <- intersect(names(df), c("link","url","pdf","doi","weblink","link_url"))
if (length(link_candidates) == 0) {
df$link <- NA_character_
} else if (!"link" %in% names(df)) {
df$link <- df[[link_candidates[1]]]
}
if ("focusarea" %in% names(df))
df$focusarea <- ifelse(is.na(df$focusarea) | df$focusarea == "", "Unspecified", df$focusarea)
if ("publicationtype" %in% names(df))
df$publicationtype <- ifelse(is.na(df$publicationtype) | df$publicationtype == "", "Unspecified", df$publicationtype)
df |> mutate(keyword_field = paste(title, focusarea, sep = " | "))
}
# Read data and build a character key for Crosstalk
pubs <- read_publications(params$data_path) |>
dplyr::ungroup() |>
dplyr::mutate(
.id = as.character(dplyr::row_number()),  # << key MUST be character
link_display = ifelse(is.na(link) | link=="", "", paste0("<a href='", link, "' target='_blank'>Open</a>"))
) |>
as.data.frame()
# ONE SharedData used by the plots (use the same group name everywhere)
sd <- crosstalk::SharedData$new(pubs, key = ~.id, group = "pubs")
git init
library(htmltools)
if (file.exists(params$pdf_path)) {
browsable(tags$iframe(src = params$pdf_path, style = "width:100%; height:90vh; border:none;", title = "Citations PDF"))
} else {
HTML(sprintf("<p><strong>PDF not found:</strong> %s</p>", params$pdf_path))
}
# ----- Setup -----
library(readr); library(dplyr); library(tidyr); library(stringr); library(janitor)
install.packages("janitor")
# ----- Setup -----
library(readr); library(dplyr); library(tidyr); library(stringr); library(janitor)
library(plotly); library(DT); library(crosstalk); library(bslib); library(htmltools)
invisible(crosstalk::crosstalkLibs())
# Pink-forward theme
theme <- bslib::bs_theme(
version = 5, bootswatch = "cosmo",
primary   = "#E91E63", body_color = "#2f3342",
base_font = bslib::font_google("Inter")
)
bslib::bs_theme_set(theme)
# ----- Data helpers -----
read_publications <- function(path) {
df <- readr::read_csv(path, show_col_types = FALSE) |>
janitor::clean_names()
if ("year" %in% names(df)) suppressWarnings(df$year <- as.integer(df$year))
for (nm in intersect(c("title","author","publicationtype","focusarea"), names(df))) {
df[[nm]] <- as.character(df[[nm]]) |> stringr::str_squish()
}
# map link column if named differently in CSV
link_candidates <- intersect(names(df), c("link","url","pdf","doi","weblink","link_url"))
if (length(link_candidates) == 0) {
df$link <- NA_character_
} else if (!"link" %in% names(df)) {
df$link <- df[[link_candidates[1]]]
}
if ("focusarea" %in% names(df))
df$focusarea <- ifelse(is.na(df$focusarea) | df$focusarea == "", "Unspecified", df$focusarea)
if ("publicationtype" %in% names(df))
df$publicationtype <- ifelse(is.na(df$publicationtype) | df$publicationtype == "", "Unspecified", df$publicationtype)
df |> mutate(keyword_field = paste(title, focusarea, sep = " | "))
}
# Read data and build a character key for Crosstalk
pubs <- read_publications(params$data_path) |>
dplyr::ungroup() |>
dplyr::mutate(
.id = as.character(dplyr::row_number()),  # << key MUST be character
link_display = ifelse(is.na(link) | link=="", "", paste0("<a href='", link, "' target='_blank'>Open</a>"))
) |>
as.data.frame()
# ONE SharedData used by the plots (use the same group name everywhere)
sd <- crosstalk::SharedData$new(pubs, key = ~.id, group = "pubs")
# ----- Optional header logo (shows only if the file exists) -----
if (!is.null(params$logo_path) && file.exists(params$logo_path)) {
bslib::card(
bslib::card_body(
bslib::layout_columns(
col_widths = c(2, 10),
htmltools::img(src = params$logo_path, alt = "Logo", style = "max-height:100px; border-radius:8px;"),
htmltools::tagList(
htmltools::h4("Publications Explorer"),
htmltools::div(style="opacity:.8;",
"Use filters to narrow by year, type, and focus area. Use the table search for author names or keywords."
)
)
)
)
)
}
bslib::layout_columns(
col_widths = c(4, 8),
# LEFT: Filters (drive plots + table via group = 'pubs')
bslib::card(
bslib::card_header("Filters"),
bslib::card_body(
htmltools::tagList(
crosstalk::filter_slider("year",  "Year",             sd, ~year),
crosstalk::filter_select("type",  "Publication type", sd, ~publicationtype, multiple = TRUE),
crosstalk::filter_select("focus", "Focus area",       sd, ~focusarea,       multiple = TRUE),
htmltools::div(
style = "margin-top:.25rem; font-size:.9rem; opacity:.8;",
"Tip: Use the table’s global search for author names or topic keywords."
)
)
)
),
# RIGHT: Stats (these values update live via the table callback below)
{
stats_df <- pubs |>
dplyr::summarise(
total    = dplyr::n(),
span     = paste0(min(year, na.rm = TRUE), "–", max(year, na.rm = TRUE)),
authors  = dplyr::n_distinct(author),
focuses  = dplyr::n_distinct(focusarea)
)
bslib::layout_column_wrap(
width = 1/2, heights_equal = "all",
bslib::value_box(
value = htmltools::tags$span(id = "stat-total",   stats_df$total),
title = "Publications", theme_color = "primary"
),
bslib::value_box(
value = htmltools::tags$span(id = "stat-span",    stats_df$span),
title = "Year span", theme_color = "primary"
),
bslib::value_box(
value = htmltools::tags$span(id = "stat-authors", stats_df$authors),
title = "Unique author entries", theme_color = "primary"
),
bslib::value_box(
value = htmltools::tags$span(id = "stat-focus",   stats_df$focuses),
title = "Focus areas", theme_color = "primary"
)
)
}
)
bslib::layout_columns(
col_widths = c(6, 6),
bslib::card(
bslib::card_header("Publications by Year"),
bslib::card_body(
plotly::plot_ly(sd, x = ~year, type = "histogram",
marker = list(color = "#E91E63")) |>
plotly::layout(xaxis = list(title = "Year"), yaxis = list(title = "Count"), bargap = 0.15)
)
),
bslib::card(
bslib::card_header("Publications by Type"),
bslib::card_body(
plotly::plot_ly(sd, x = ~publicationtype, type = "histogram",
marker = list(color = "#E91E63")) |>
plotly::layout(xaxis = list(title = ""), yaxis = list(title = "Count"))
)
)
)
fa_counts <- pubs |> dplyr::count(focusarea, name = "n") |> dplyr::arrange(dplyr::desc(n)) |> dplyr::slice_head(n = 15)
bslib::card(
bslib::card_header("Top Focus Areas"),
bslib::card_body(
plotly::plot_ly(
sd,
y = ~factor(focusarea, levels = fa_counts$focusarea[order(fa_counts$n)]),
type = "histogram", orientation = "h",
marker = list(color = "#E91E63")
) |>
plotly::layout(xaxis = list(title = "Count"), yaxis = list(title = ""), margin = list(l = 180))
)
)
fa_counts <- pubs |> dplyr::count(focusarea, name = "n") |> dplyr::arrange(dplyr::desc(n)) |> dplyr::slice_head(n = 15)
bslib::card(
bslib::card_header("Top Focus Areas"),
bslib::card_body(
plotly::plot_ly(
sd,
y = ~factor(focusarea, levels = fa_counts$focusarea[order(fa_counts$n)]),
type = "histogram", orientation = "h",
marker = list(color = "#E91E63")
) |>
plotly::layout(xaxis = list(title = "Count"), yaxis = list(title = ""), margin = list(l = 180))
)
)
# ----- Setup -----
library(readr); library(dplyr); library(tidyr); library(stringr); library(janitor)
library(plotly); library(DT); library(crosstalk); library(bslib); library(htmltools)
invisible(crosstalk::crosstalkLibs())
# Pink-forward theme
theme <- bslib::bs_theme(
version = 5, bootswatch = "cosmo",
primary   = "#E91E63", body_color = "#2f3342",
base_font = bslib::font_google("Inter")
)
bslib::bs_theme_set(theme)
# ----- Data helpers -----
read_publications <- function(path) {
df <- readr::read_csv(path, show_col_types = FALSE) |>
janitor::clean_names()
if ("year" %in% names(df)) suppressWarnings(df$year <- as.integer(df$year))
for (nm in intersect(c("title","author","publicationtype","focusarea"), names(df))) {
df[[nm]] <- as.character(df[[nm]]) |> stringr::str_squish()
}
# map link column if named differently in CSV
link_candidates <- intersect(names(df), c("link","url","pdf","doi","weblink","link_url"))
if (length(link_candidates) == 0) {
df$link <- NA_character_
} else if (!"link" %in% names(df)) {
df$link <- df[[link_candidates[1]]]
}
if ("focusarea" %in% names(df))
df$focusarea <- ifelse(is.na(df$focusarea) | df$focusarea == "", "Unspecified", df$focusarea)
if ("publicationtype" %in% names(df))
df$publicationtype <- ifelse(is.na(df$publicationtype) | df$publicationtype == "", "Unspecified", df$publicationtype)
df |> mutate(keyword_field = paste(title, focusarea, sep = " | "))
}
# Read data and build a character key for Crosstalk
pubs <- read_publications(params$data_path) |>
dplyr::ungroup() |>
dplyr::mutate(
.id = as.character(dplyr::row_number()),  # << key MUST be character
link_display = ifelse(is.na(link) | link=="", "", paste0("<a href='", link, "' target='_blank'>Open</a>"))
) |>
as.data.frame()
# ONE SharedData used by the plots (use the same group name everywhere)
sd <- crosstalk::SharedData$new(pubs, key = ~.id, group = "pubs")
# ----- Optional header logo (shows only if the file exists) -----
if (!is.null(params$logo_path) && file.exists(params$logo_path)) {
bslib::card(
bslib::card_body(
bslib::layout_columns(
col_widths = c(2, 10),
htmltools::img(src = params$logo_path, alt = "Logo", style = "max-height:100px; border-radius:8px;"),
htmltools::tagList(
htmltools::h4("Publications Explorer"),
htmltools::div(style="opacity:.8;",
"Use filters to narrow by year, type, and focus area. Use the table search for author names or keywords."
)
)
)
)
)
}
bslib::layout_columns(
col_widths = c(4, 8),
# LEFT: Filters (drive plots + table via group = 'pubs')
bslib::card(
bslib::card_header("Filters"),
bslib::card_body(
htmltools::tagList(
crosstalk::filter_slider("year",  "Year",             sd, ~year),
crosstalk::filter_select("type",  "Publication type", sd, ~publicationtype, multiple = TRUE),
crosstalk::filter_select("focus", "Focus area",       sd, ~focusarea,       multiple = TRUE),
htmltools::div(
style = "margin-top:.25rem; font-size:.9rem; opacity:.8;",
"Tip: Use the table’s global search for author names or topic keywords."
)
)
)
),
# RIGHT: Stats (these values update live via the table callback below)
{
stats_df <- pubs |>
dplyr::summarise(
total    = dplyr::n(),
span     = paste0(min(year, na.rm = TRUE), "–", max(year, na.rm = TRUE)),
authors  = dplyr::n_distinct(author),
focuses  = dplyr::n_distinct(focusarea)
)
bslib::layout_column_wrap(
width = 1/2, heights_equal = "all",
bslib::value_box(
value = htmltools::tags$span(id = "stat-total",   stats_df$total),
title = "Publications", theme_color = "primary"
),
bslib::value_box(
value = htmltools::tags$span(id = "stat-span",    stats_df$span),
title = "Year span", theme_color = "primary"
),
bslib::value_box(
value = htmltools::tags$span(id = "stat-authors", stats_df$authors),
title = "Unique author entries", theme_color = "primary"
),
bslib::value_box(
value = htmltools::tags$span(id = "stat-focus",   stats_df$focuses),
title = "Focus areas", theme_color = "primary"
)
)
}
)
bslib::layout_columns(
col_widths = c(6, 6),
bslib::card(
bslib::card_header("Publications by Year"),
bslib::card_body(
plotly::plot_ly(sd, x = ~year, type = "histogram",
marker = list(color = "#E91E63")) |>
plotly::layout(xaxis = list(title = "Year"), yaxis = list(title = "Count"), bargap = 0.15)
)
),
bslib::card(
bslib::card_header("Publications by Type"),
bslib::card_body(
plotly::plot_ly(sd, x = ~publicationtype, type = "histogram",
marker = list(color = "#E91E63")) |>
plotly::layout(xaxis = list(title = ""), yaxis = list(title = "Count"))
)
)
)
# ----- Setup -----
library(readr); library(dplyr); library(tidyr); library(stringr); library(janitor)
library(plotly); library(DT); library(crosstalk); library(bslib); library(htmltools)
invisible(crosstalk::crosstalkLibs())
# Pink
theme <- bslib::bs_theme(
version = 5, bootswatch = "cosmo",
primary   = "#E91E63", body_color = "#2f3342",
base_font = bslib::font_google("Inter")
)
bslib::bs_theme_set(theme)
read_publications <- function(path) {
df <- readr::read_csv(path, show_col_types = FALSE) |>
janitor::clean_names()
if ("year" %in% names(df)) suppressWarnings(df$year <- as.integer(df$year))
for (nm in intersect(c("title","author","publicationtype","focusarea"), names(df))) {
df[[nm]] <- as.character(df[[nm]]) |> stringr::str_squish()
}
# map link column if named differently in CSV
link_candidates <- intersect(names(df), c("link","url","pdf","doi","weblink","link_url"))
if (length(link_candidates) == 0) {
df$link <- NA_character_
} else if (!"link" %in% names(df)) {
df$link <- df[[link_candidates[1]]]
}
if ("focusarea" %in% names(df))
df$focusarea <- ifelse(is.na(df$focusarea) | df$focusarea == "", "Unspecified", df$focusarea)
if ("publicationtype" %in% names(df))
df$publicationtype <- ifelse(is.na(df$publicationtype) | df$publicationtype == "", "Unspecified", df$publicationtype)
df |> mutate(keyword_field = paste(title, focusarea, sep = " | "))
}
# Read data and build a character key for Crosstalk
pubs <- read_publications(params$data_path) |>
dplyr::ungroup() |>
dplyr::mutate(
.id = as.character(dplyr::row_number()),
link_display = ifelse(is.na(link) | link=="", "", paste0("<a href='", link, "' target='_blank'>Open</a>"))
) |>
as.data.frame()
sd <- crosstalk::SharedData$new(pubs, key = ~.id, group = "pubs")
library(readr); library(dplyr); library(tidyr); library(stringr); library(janitor)
library(plotly); library(DT); library(crosstalk); library(bslib); library(htmltools)
invisible(crosstalk::crosstalkLibs())
# Pink
theme <- bslib::bs_theme(
version = 5, bootswatch = "cosmo",
primary   = "#E91E63", body_color = "#2f3342",
base_font = bslib::font_google("Inter")
)
bslib::bs_theme_set(theme)
read_publications <- function(path) {
df <- readr::read_csv(
path,
show_col_types = FALSE,
na = c("", "NA", "N/A")
) |>
janitor::clean_names()
nm <- names(df)
if ("focus_area" %in% nm && !"focusarea" %in% nm) df <- dplyr::rename(df, focusarea = focus_area)
if ("focus.area" %in% nm && !"focusarea" %in% nm) df <- dplyr::rename(df, focusarea = `focus.area`)
if ("publication_type" %in% nm && !"publicationtype" %in% nm) df <- dplyr::rename(df, publicationtype = publication_type)
if ("publication.type" %in% nm && !"publicationtype" %in% nm) df <- dplyr::rename(df, publicationtype = `publication.type`)
if ("year" %in% names(df)) suppressWarnings(df$year <- as.integer(df$year))
trim_if_char <- function(x) if (is.character(x)) stringr::str_trim(x) else x
df <- dplyr::mutate(df, dplyr::across(dplyr::everything(), trim_if_char))
link_candidates <- intersect(names(df), c("link","url","pdf","doi","weblink","link_url"))
if (length(link_candidates) == 0) {
df$link <- NA_character_
} else if (!"link" %in% names(df)) {
df$link <- df[[link_candidates[1]]]
}
# blanks -> "Unspecified". Otherwise show EXACT CSV text
if ("focusarea" %in% names(df)) {
df$focusarea <- ifelse(is.na(df$focusarea) | df$focusarea == "", "Unspecified", df$focusarea)
} else {
df$focusarea <- "Unspecified"
}
if ("publicationtype" %in% names(df)) {
df$publicationtype <- ifelse(is.na(df$publicationtype) | df$publicationtype == "", "Unspecified", df$publicationtype)
} else {
df$publicationtype <- "Unspecified"
}
# Keep titles/authors as-is
for (nm in intersect(c("title","author"), names(df))) {
df[[nm]] <- as.character(df[[nm]]) |> stringr::str_squish()
}
df |> dplyr::mutate(keyword_field = paste(title, focusarea, sep = " | "))
}
pubs <- read_publications(params$data_path) |>
dplyr::ungroup() |>
dplyr::mutate(
.id = as.character(dplyr::row_number()),
link_display = ifelse(is.na(link) | link == "", "", paste0("<a href='", link, "' target='_blank'>Open</a>"))
) |>
as.data.frame()
sd <- crosstalk::SharedData$new(pubs, key = ~.id, group = "pubs")
if (!is.null(params$logo_path) && file.exists(params$logo_path)) {
bslib::card(
bslib::card_body(
bslib::layout_columns(
col_widths = c(2, 10),
htmltools::img(src = params$logo_path, alt = "Logo", style = "max-height:100px; border-radius:8px;"),
htmltools::tagList(
htmltools::h4("Publications Explorer"),
htmltools::div(style="opacity:.8;",
"Use filters to narrow by year, type, and focus area. Use the table search for author names or keywords."
)
)
)
)
)
}
bslib::layout_columns(
col_widths = c(4, 8),
# LEFT: Filters
bslib::card(
bslib::card_header("Filters"),
bslib::card_body(
htmltools::tagList(
crosstalk::filter_slider("year",  "Year",             sd, ~year),
crosstalk::filter_select("type",  "Publication type", sd, ~publicationtype, multiple = TRUE),
crosstalk::filter_select("focus", "Focus area",       sd, ~focusarea,       multiple = TRUE),
htmltools::div(
style = "margin-top:.25rem; font-size:.9rem; opacity:.8;",
"Tip: Use the table’s global search for author names or topic keywords."
)
)
)
),
# RIGHT: Stats
{
stats_df <- pubs |>
dplyr::summarise(
total    = dplyr::n(),
span     = paste0(min(year, na.rm = TRUE), "–", max(year, na.rm = TRUE)),
authors  = dplyr::n_distinct(author),
focuses  = dplyr::n_distinct(focusarea)
)
bslib::layout_column_wrap(
width = 1/2, heights_equal = "all",
bslib::value_box(
value = htmltools::tags$span(id = "stat-total",   stats_df$total),
title = "Publications", theme_color = "primary"
),
bslib::value_box(
value = htmltools::tags$span(id = "stat-span",    stats_df$span),
title = "Year span", theme_color = "primary"
),
bslib::value_box(
value = htmltools::tags$span(id = "stat-authors", stats_df$authors),
title = "Unique author entries", theme_color = "primary"
),
bslib::value_box(
value = htmltools::tags$span(id = "stat-focus",   stats_df$focuses),
title = "Focus areas", theme_color = "primary"
)
)
}
)
