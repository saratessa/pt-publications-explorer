---
title: "Publications Dashboard"
format:
  html:
    theme: cosmo
    toc: true
    page-layout: full
server: shiny
editor: visual
execute:
  echo: false
  warning: false
  message: false
params:
  data_path: "/Users/saratessapalos/Desktop/Research/Dashboard/data/s palos - Sheet1.csv"
---

```{r}
#| label: setup
#| include: false
library(readr)
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(plotly)
library(DT)
library(bslib)
library(janitor)
library(shiny)

# Helper: read and normalize expected columns:
# title, author, year, publicationtype, focusarea, link
read_publications <- function(path) {
  df <- readr::read_csv(path, show_col_types = FALSE) |>
    janitor::clean_names()
  # coerce year to integer when possible
  if ("year" %in% names(df)) suppressWarnings(df$year <- as.integer(df$year))
  # squish text & fill blanks
  for (nm in intersect(c("title","author","publicationtype","focusarea"), names(df))) {
    df[[nm]] <- df[[nm]] |> as.character() |> stringr::str_squish()
  }
  if ("focusarea" %in% names(df)) df$focusarea <- ifelse(is.na(df$focusarea) | df$focusarea=="", "Unspecified", df$focusarea)
  if ("publicationtype" %in% names(df)) df$publicationtype <- ifelse(is.na(df$publicationtype) | df$publicationtype=="", "Unspecified", df$publicationtype)
  df
}

pubs <- read_publications(params$data_path)

# choices for filters
years_all <- sort(unique(na.omit(pubs$year)))
if (length(years_all) == 0) years_all <- c(2000L, 2025L)
yr_min <- min(years_all, na.rm = TRUE)
yr_max <- max(years_all, na.rm = TRUE)

types_all <- pubs$publicationtype |> unique() |> sort(na.last = TRUE)
focus_all <- pubs$focusarea |> unique() |> sort(na.last = TRUE)

```

